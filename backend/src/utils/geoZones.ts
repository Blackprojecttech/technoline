// Проверка попадания точки в полигон (алгоритм луча)
export function isPointInPolygon(
  point: [number, number],
  polygon: [number, number][],
): boolean {
  const [x, y] = point;
  let inside = false;
  for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {
    const [xi, yi] = polygon[i];
    const [xj, yj] = polygon[j];
    const intersect =
      yi > y !== yj > y &&
      x < ((xj - xi) * (y - yi)) / (yj - yi + 0.0000001) + xi;
    if (intersect) inside = !inside;
  }
  return inside;
}

// Массивы координат МКАД и ЦКАД (пример, заменить на актуальные)
export const MKAD_POLYGON: [number, number][] = [
  [37.842762, 55.774558],
  [37.842789, 55.76522],
  [37.842627, 55.755723],
  [37.841828, 55.747399],
  [37.841217, 55.739103],
  [37.840175, 55.730482],
  [37.83916, 55.721939],
  [37.837121, 55.712203],
  [37.83262, 55.703048],
  [37.829512, 55.694287],
  [37.831353, 55.68529],
  [37.834605, 55.675945],
  [37.837597, 55.667752],
  [37.839348, 55.658667],
  [37.833842, 55.650053],
  [37.824787, 55.643713],
  [37.814564, 55.637347],
  [37.802473, 55.62913],
  [37.794235, 55.623758],
  [37.781928, 55.617713],
  [37.771139, 55.611755],
  [37.758725, 55.604956],
  [37.747945, 55.599677],
  [37.734785, 55.594143],
  [37.723062, 55.589234],
  [37.709425, 55.583983],
  [37.696256, 55.578834],
  [37.683167, 55.574019],
  [37.668911, 55.571999],
  [37.647765, 55.573093],
  [37.633419, 55.573928],
  [37.616719, 55.574732],
  [37.60107, 55.575816],
  [37.586536, 55.5778],
  [37.571938, 55.581271],
  [37.555732, 55.585143],
  [37.545132, 55.587509],
  [37.526366, 55.5922],
  [37.516108, 55.594728],
  [37.502274, 55.60249],
  [37.49391, 55.609685],
  [37.484846, 55.617424],
  [37.474668, 55.625801],
  [37.469925, 55.630207],
  [37.456864, 55.641041],
  [37.448195, 55.648794],
  [37.441125, 55.654675],
  [37.434424, 55.660424],
  [37.42598, 55.670701],
  [37.418712, 55.67994],
  [37.414868, 55.686873],
  [37.407528, 55.695697],
  [37.397952, 55.702805],
  [37.388969, 55.709657],
  [37.383283, 55.718273],
  [37.378369, 55.728581],
  [37.374991, 55.735201],
  [37.370248, 55.744789],
  [37.369188, 55.75435],
  [37.369053, 55.762936],
  [37.369619, 55.771444],
  [37.369853, 55.779722],
  [37.372943, 55.789542],
  [37.379824, 55.79723],
  [37.386876, 55.805796],
  [37.390397, 55.814629],
  [37.393236, 55.823606],
  [37.395275, 55.83251],
  [37.398787, 55.840376],
  [37.405267, 55.850141],
  [37.414868, 55.859507],
  [37.423541, 55.867051],
  [37.433324, 55.872703],
  [37.444659, 55.877041],
  [37.459953, 55.881091],
  [37.473282, 55.884648],
  [37.48861, 55.888206],
  [37.5016, 55.892014],
  [37.517501, 55.895538],
  [37.533617, 55.898533],
  [37.5483, 55.900586],
  [37.564098, 55.902484],
  [37.579601, 55.903603],
  [37.594331, 55.904417],
  [37.608938, 55.904417],
  [37.622504, 55.904417],
  [37.636661, 55.904417],
  [37.65053, 55.904417],
  [37.664399, 55.904417],
  [37.678268, 55.904417],
  [37.692137, 55.904417],
  [37.705706, 55.904417],
  [37.719575, 55.904417],
  [37.733444, 55.904417],
  [37.747313, 55.904417],
  [37.761182, 55.904417],
  [37.775051, 55.904417],
  [37.78892, 55.904417],
  [37.802789, 55.904417],
  [37.816658, 55.904417],
  [37.830527, 55.904417],
  [37.842762, 55.774558], // замыкаем полигон
];
export const CKAD_POLYGON: [number, number][] = [
  [36.982727,55.899956],
  [36.970367,55.854504],
  [36.962128,55.81903],
  [36.960754,55.799737],
  [36.959381,55.774256],
  [36.953888,55.739482],
  [36.945648,55.696164],
  [36.925049,55.658221],
  [36.941528,55.617916],
  [36.9841,55.586107],
  [37.011566,55.568252],
  [37.102203,55.53718],
  [37.150269,55.49286],
  [37.144775,55.443037],
  [37.207947,55.427455],
  [37.372742,55.429013],
  [37.43454,55.401731],
  [37.569122,55.382231],
  [37.654266,55.386132],
  [37.87262,55.411087],
  [37.938538,55.42122],
  [37.799835,55.406409],
  [38.001709,55.434468],
  [38.030548,55.445374],
  [38.079987,55.457835],
  [38.115692,55.473405],
  [38.150024,55.506083],
  [38.156891,55.533294],
  [38.228302,55.548058],
  [38.310699,55.563592],
  [38.307953,55.587659],
  [38.310699,55.622568],
  [38.349152,55.679907],
  [38.405457,55.696164],
  [38.438416,55.717055],
  [38.486481,55.746439],
  [38.512573,55.779662],
  [38.505707,55.839085],
  [38.486481,55.882244],
  [38.419189,55.916121],
  [38.372498,55.926894],
  [38.295593,55.946893],
  [38.213196,55.970724],
  [38.099213,55.976104],
  [38.038788,56.022181],
  [38.005829,56.0498],
  [37.963257,56.073568],
  [37.917938,56.092725],
  [37.838287,56.113404],
  [37.792969,56.127184],
  [37.672119,56.134072],
  [37.611694,56.153199],
  [37.532043,56.153199],
  [37.441406,56.14708],
  [37.397461,56.138664],
  [37.352142,56.12948],
  [37.312317,56.115701],
  [37.273865,56.094258],
  [37.2258,56.078933],
  [37.161255,56.057469],
  [37.118683,56.029855],
  [37.048645,55.996845],
  [37.044525,55.976872],
  [37.023926,55.937664],
  [36.997833,55.912273],
  [36.981354,55.893796],
  [36.982727,55.899956] // замыкаем полигон
];

// Определение зоны по координатам
export function getDeliveryZoneByCoords(
  coords: [number, number],
): "mkad" | "ckad" | "region" {
  if (isPointInPolygon(coords, MKAD_POLYGON)) return "mkad";
  if (isPointInPolygon(coords, CKAD_POLYGON)) return "ckad";
  return "region";
}

// Вычисление расстояния между двумя точками (координатами) в километрах
export function getDistance(
  lat1: number, lon1: number, lat2: number, lon2: number
): number {
  const R = 6371; // Радиус Земли в км
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLon = (lon2 - lon1) * Math.PI / 180;
  const a =
    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
    Math.sin(dLon / 2) * Math.sin(dLon / 2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  return R * c;
}
 